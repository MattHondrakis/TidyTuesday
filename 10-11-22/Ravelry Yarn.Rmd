---
title: "Ravelry Yarn"
author: "Matthew"
date: "2022-10-11"
output: 
  github_document:
    toc: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, dpi = 500)
library(tidyverse)
library(scales)
theme_set(theme_bw())
```

```{r}
yarn <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-10-11/yarn.csv')
```

```{r}
skimr::skim(yarn)
```

# EDA

```{r}
yarn %>% 
  keep(is.numeric) %>% 
  select(-thread_size, -rating_total) %>% 
  cor(use = "complete.obs", method = "spearman") %>% 
  as.data.frame() %>% 
  rownames_to_column(var = "item1") %>% 
  gather(key = item2, value = corr, -item1) %>% 
  filter(item1 > item2) %>% 
  arrange(-abs(corr))
```

```{r}
yarn %>% 
  filter(!is.na(discontinued)) %>% 
  ggplot(aes(rating_average, fill = discontinued)) + geom_density(alpha = 0.5)
```

```{r}
mod_data <- yarn %>% 
  select(contains("discontinued"), where(is.numeric)) %>% 
  select(-thread_size, -rating_total) %>% 
  mutate(discontinued = factor(discontinued))

quickmod <- glm(discontinued ~., mod_data, family = binomial())

summary(quickmod)
```

```{r}
mod_data %>% 
  mutate(predictions = 1 - predict(quickmod, mod_data, type = "response")) %>% 
  yardstick::roc_curve(discontinued, predictions) %>% 
  autoplot()

mod_data %>% 
  mutate(predictions = 1 - predict(quickmod, mod_data, type = "response")) %>% 
  yardstick::roc_auc(discontinued, predictions)
```


