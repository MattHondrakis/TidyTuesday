---
title: "Freedom"
author: "Matthew"
date: "2/21/2022"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
theme_set(theme_bw())
```


```{r}
freedom <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-22/freedom.csv")
freedom <- freedom %>%
  rename_with(tolower)
```


# EDA
```{r}
freedom %>%
  select(where(is.numeric)) %>%
  gather() %>%
  ggplot(aes(value)) + geom_histogram() + facet_wrap(~key, scales = "free")
```


## Cl ~ Pr relationship
```{r}
freedom %>%
  lm(cl ~ pr,.) %>%
  summary()
```


## Top countries
```{r}
x <- freedom %>%
  filter(year == 2020) %>%
  mutate(pr = -pr + 8,
         cl = -cl + 8,
         total = cl + pr) %>%
  arrange(-total) %>%
  head(41)

freedom %>%
  filter(country %in% x$country) %>%
  select(country, year, pr, cl) %>%
  pivot_longer(c("pr","cl")) %>%
  mutate(value = -value + 8) %>%
  group_by(country) %>%
  mutate(total = sum(value)) %>%
  ggplot(aes(value, fct_reorder2(country, value, total, .desc = FALSE), fill = name)) + geom_col() +
  labs(y = "", x = "Total Score", subtitle = "Countries that had best scores in 2020",
       title = "Best 30 Countries based on Civil Liberties and Political Rights",
       caption = "Total Score = Sum of scores from 1995 - 2020")
```


## Status
```{r}
freedom %>%
  mutate(pr = -pr +8,
         cl = -cl +8) %>%
  group_by(status) %>%
  summarize(mean_pr = mean(pr),
            mean_cl = mean(cl)) %>%
  pivot_longer(-status) %>%
  ggplot(aes(value, fct_reorder(status, value), fill = fct_reorder(status, value))) + geom_col() +
  facet_wrap(~name) + labs(y = "", x = "Average Value") 
```


### By Region
```{r}
freedom %>%
  mutate(status = fct_relevel(status,"NF", "PF", "F")) %>%
  ggplot(aes(fill = status, y = fct_reorder(region_name, status, .fun = function(.x) mean(.x == "F")))) + 
  geom_bar(position = "fill") + labs(y = "") + scale_fill_manual(values = c("#B81D13", "#F5A33E", "#00C301"))
```


