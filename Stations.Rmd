---
title: "Stations"
author: "Matthew"
date: "2/28/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(broom)
library(lubridate)
theme_set(theme_bw())
```


```{r}
stations <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-03-01/stations.csv')
stations <- stations %>%
  select(where(~any(!is.na(.x)))) %>%
  rename_with(tolower) %>%
  select(-objectid) %>%
  mutate(open_date = as.Date(open_date))


```
 
 
```{r}
stations %>%
  keep(is.numeric) %>%
  gather() %>%
  ggplot(aes(value)) + geom_histogram() + facet_wrap(~key, scales = "free")

stations %>%
  group_by(state) %>%
  count(fuel_type_code) %>%
  mutate(total = sum(n)) %>%
  filter(!is.na(n)) %>%
  ggplot(aes(n, y = fct_reorder(state, total), fill = fct_reorder(fuel_type_code, n))) +
  geom_col() + labs(y = "State", x = "Count", fill = "Fuel") +
  scale_fill_brewer(palette = "Dark2", direction = -1)
```


```{r}
stations %>%
  count(open_date, sort = TRUE) %>%
  filter(year(open_date) > 2010) %>%
  ggplot(aes(open_date, n)) + geom_line()

stations %>%
  filter(open_date == "2021-01-27") %>%
  count(state, sort = TRUE) %>%
  ggplot(aes(n, y = fct_reorder(state, n))) +
  geom_col() + labs(y = "State", x = "Count", fill = "Fuel")
```

