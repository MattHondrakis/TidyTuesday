---
title: "UK Paygap"
author: "Matthew Hondrakis"
date: '2022-06-29'
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, dpi = 500)
library(tidyverse)
library(patchwork)
library(scales)
library(lubridate)
theme_set(theme_bw())
```



```{r}
paygap <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-06-28/paygap.csv')
```



```{r}
paygap %>% 
  arrange(-abs(diff_mean_hourly_percent)) %>% 
  select(employer_name, diff_mean_hourly_percent, employer_size)

paygap %>% 
  arrange(-abs(diff_median_hourly_percent)) %>% 
  select(employer_name, diff_median_hourly_percent, employer_size)
```



```{r}
paygap %>% 
  ggplot(aes(employer_size, diff_mean_hourly_percent)) +
  geom_boxplot()

paygap %>% 
  filter(employer_size != "Not Provided") %>% 
  mutate(new = as.factor(parse_number(employer_size))) %>% 
  ggplot(aes(new, diff_mean_hourly_percent)) + geom_boxplot()
```


```{r}
test_data <- paygap %>% 
  filter(employer_size != "Not Provided") %>% 
  mutate(new = as.factor(parse_number(employer_size)))

summary(aov(diff_mean_hourly_percent ~ new, test_data))

pairwise.t.test(paygap$diff_mean_hourly_percent, paygap$employer_size)
```



```{r}
paygap %>% 
  mutate(color = ifelse(diff_median_hourly_percent > 0, "Men", "Women"),
         diff = abs(diff_median_hourly_percent)) %>% 
  group_by(employer_name) %>% 
  arrange(-abs(diff_median_hourly_percent)) %>% 
  head(20) %>% 
  ggplot(aes(diff, 
             fct_reorder(str_to_title(employer_name), diff),
             fill = color)) + 
  geom_col() +
  labs(y = "", x = "")

gplot <- function(x){
  paygap %>% 
    mutate(color = ifelse({{x}} > 0, "Men", "Women"),
           diff = abs({{x}})) %>% 
    group_by(employer_name, color) %>% 
    summarize(diff = max(diff)) %>% 
    arrange(-abs(diff)) %>% 
    head(20) %>% 
    ggplot(aes(diff, 
               fct_reorder(str_to_title(employer_name), diff),
               fill = color)) + 
    geom_col() +
    labs(y = "", x = "")
}
gplot(diff_median_hourly_percent)

gplot(diff_mean_hourly_percent)
```


